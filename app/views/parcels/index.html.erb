<% provide(:title, "Encomendas") %>

<% content_for :navpills do %>
  <%= link_to "Geral", parcels_path, class: "h6 btn btn-secondary ps-2 pe-2 pt-0 pb-0 mt-4 rounded-pill me-2" %>
<% end %>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-3 border-bottom">

<%= form_with url: parcels_path, method: :get, local: true, class: "row g-2" do |form| %>
  <div class="input-group">
    <%= form.label :query, "Pesquisar", class: "visually-hidden" %>
    <%= form.text_field :query, placeholder: "Pesquisar", value: params[:query], class: "form-control" %>
    <!--
    <%= form.label :branch_id, "Filtrar por Origem", class: "visually-hidden" %>
    <%= form.select :branch_id, options_from_collection_for_select(@branches, :id, :name, params[:branch_id]), { prompt: "Todas as filiais" }, class: "form-select" %>
    -->
    <%= form.label :status, "Filtrar por Estado", class: "visually-hidden" %>
    <%= form.select :status, ["Registrado", "Em trânsito", "Entregue"], { prompt: "Todos os estados" }, class: "form-select" %>
    <%= form.submit "Pesquisar", class: "btn btn-sm btn-secondary" %>
  </div>
<% end %>

  <div class="btn-toolbar mb-md-0">
    <%= link_to "Adicionar", new_parcel_path , class: "btn btn-sm btn-success me-2" %>        
  </div>

</div>

<div class="table-responsive small">
<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>Código</th>
      <th>Conteúdo</th>
      <th>Origem</th>
      <th>Destino</th>
      <th>Remetente</th>
      <th>Destinatário</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @parcels.each do |parcel| %>
      <tr>
        <td><%= parcel.parcel_code %></td>
        <td><%= truncate(parcel.contents_description, length: 40) %></td>
        <td><%= parcel.origin_branch&.name || "—" %></td>
        <td><%= parcel.destination_branch&.name || "—" %></td>
        <td><%= parcel.sender&.full_name || "—" %></td>
        <td><%= parcel.recipient&.full_name || "—" %></td>
        <td class="text-end">
          <a href="/parcels/<%= parcel.id %>" class="btn btn-sm btn-outline-info ps-2 pe-2 pt-1 pb-1 me-1">Visualizar</a>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

<%= render "layouts/partials/flash_toasts" %>